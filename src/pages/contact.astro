---
import OtherLayout from '@lay/OtherLayout.astro';

const name = 'Dex';
const email = 'richardk80@icloud.com';
---

<OtherLayout title="Contact" pagetitle="Contact Us">
  <!-- Contact form section -->
  <div id="contactForm" class="mb-2 ml-0.5">
      <form id="contactFormElement" action="/api/submit" method="POST" class="space-y-2" onsubmit="handleSubmit(event)">
          <input
            type="text"
            id="name"
            name="name"
            required
            class="p-2 w-full text-sm border border-gray-300 focus:outline-none cursor-not-allowed caret-transparent select-none hidden"
            value={name}
            autocomplete={name}
          />

          <input
            type="email"
            id="email"
            name="email"
            required
            class="p-2 w-full text-sm border border-gray-300 focus:outline-none cursor-not-allowed caret-transparent select-none hidden"
            value={email}
            autocomplete={email}
          />

        <!-- Dropdown for Reason to Contact -->
        <div>
          <select
            id="reason"
            name="reason"
            required
            class="py-1 px-3 pr-5 block w-full border border-zinc-300 text-sm focus:border-zinc-300 focus:ring-1">
            <option value="" selected>Select Reason</option>
            <option value="Support">Support</option>
            <option value="Feedback">Feedback</option>
            <option value="Privacy">Privacy</option>
            <option value="Press">Press</option>
          </select>
        </div>

          <textarea
            id="message"
            name="message"
            required
            class="p-2 w-full text-sm border border-gray-300 focus:border-zinc-300 focus:ring-1 resize-none"
            rows="6"
            placeholder="Type your message here"
          ></textarea>
        
        <button
          type="submit"
          class="bg-zinc-100 hover:bg-zinc-200 text-xs border border-black py-0.5 px-2"
        >
          Send
        </button>
      </form>
  </div>

  <!-- Thank You message section, initially hidden -->
  <div id="thankYouMessage" class="hidden text-center py-14">
      <h1 class="text-3xl font-bold mb-2">Thank You!</h1>
      <p class="text-lg">Your message was sent successfully</p>
      <p class="text-[10px] text-center mt-5">Redirecting to your homepage in <span class="text-red-600 font-semibold" id="seconds">10</span> seconds</p>
  </div>
</OtherLayout>

<!-- JavaScript for handling form submission and thank-you message -->
<script is:inline>
  // Handle form submission
  function handleSubmit(event) {
    event.preventDefault();

    // Simulate form submission with fetch (replace with actual API call)
    const formData = new FormData(event.target);

    fetch("/api/submit", {
      method: "POST",
      body: formData
    })
    .then(response => {
      if (response.ok) {
        document.getElementById('contactForm').style.display = 'none';
        document.getElementById('thankYouMessage').classList.remove('hidden');
        document.getElementById('pagetitle').style.display = 'none'; // Hide the pagetitle
        startCountdown();
      } else {
        console.error('Error submitting form');
      }
    })
    .catch(error => {
      console.error('Error:', error);
    });
  }

  // Countdown and redirection to the homepage
  function startCountdown() {
    let timeLeft = 10;
    
    function tick() {
      document.getElementById('seconds').textContent = timeLeft.toString();
      if (timeLeft > 0) {
        timeLeft--;
        setTimeout(tick, 1000);
      } else {
        window.location.href = "/";
      }
    }
    
    setTimeout(tick, 1000);
  }

  // Clear the default selection for the reason dropdown
  function clearSelection() {
    const selectElement = document.getElementById('reason');
    const firstOption = selectElement.options[0];
    firstOption.selected = false;
  }
</script>