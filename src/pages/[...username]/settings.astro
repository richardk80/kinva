---
import Layout from '@lay/Layout.astro';
import NonRegularBox from '@com/main/NonRegularBox.astro';
import SmallLink from '@com/main/SmallLink.astro';
import { Icon } from 'astro-icon/components';

import users from '../../pages/api/users.json';

const { username } = Astro.params;

console.log('Username from URL:', username);

console.log('Users array:', users);

const page = users.find(user => user.username === username);

console.log('Found page:', page);

if (!page) {
  return new Response('User not found', { status: 404 });
}

const { name, email, id, loggedin, profilepic, twofactor } = page;
---
<Layout title="Account Settings">
	<div class="mx-auto w-[690px] mb-2">
		<h1 class="text-[25.6px] font-semibold text-balance">Account Settings</h1>
            <form class="grid gap-y-2 mt-3" method="post" enctype="application/json">
                <NonRegularBox 
                    name="Basic Details" 
                    pclass="flex items-center justify-between mx-2 text-sm font-semibold text-white mb-0.5 mt-1" 
                    backgroundColor="bg-blue-400" 
                    borderColor="border-blue-400">
                <div class="mx-2 mb-2">
                        <div class="mt-1.5 space-y-2">
                        <div>
                            <div class="text-[12.8px] ml-0.5">Profile Image:</div>
                            <Icon class="w-40 h-40" name="avatar" />
                        </div>
                        <div class="flex items-center space-x-4 pt-0.5">
                            <label for="file-upload" class="py-[1.5px] px-[15px] bg-gray-100 hover:bg-gray-200 text-xs border border-gray-400 focus:outline-none cursor-pointer">
                                Upload
                            </label>
                            <input id="file-upload" type="file" class="hidden">
                            <button class="py-[1.5px] px-[15px] bg-red-600 hover:bg-red-700 text-white text-xs border border-red-900 focus:outline-none cursor-pointer" type="button">Delete</button>
                        </div>
                        <div>
                            <div class="text-[12.8px] ml-0.5">Account ID:</div>
                            <input type="text" name="id" class="max-w-[18ch] py-1 px-2 block w-full border border-gray-300 text-sm focus:border-gray-300 focus:ring-transparent text-gray-500" value="546786" value={id} disabled>
                        </div>
                        <div>
                            <div class="text-[12.8px] ml-0.5">Email Address:</div>
                            <input type="email" name="email" class="py-1 px-2 block w-full border border-gray-300 text-sm focus:border-gray-300 focus:ring-transparent" value={email} />
                        </div>
                        <div>
                            <div class="text-[12.8px] ml-0.5">Your First Name:</div>
                            <input type="text" name="name" class="py-1 px-2 block w-full border border-gray-300 text-sm focus:border-gray-300 focus:ring-transparent" value={name} />
                        </div>
                        <div>
                            <div class="text-[12.8px]">
                                Username: (optional)
                            </div>
                            <div>
                                <div class="flex items-center">
                                  <div class="inline-flex items-center min-w-fit bg-blue-400 text-sm text-white border-l border-t border-b border-gray-300 py-1 px-2 select-none">https://himoot.com/</div>
                                  <input type="text" name="username" class="py-1 px-2 block w-full border-l-0 border-r border-t border-b border-gray-300 text-sm focus:z-10 focus:border-gray-300 focus:ring-0 focus:ring-transparent" value={username}>
                                </div>
                            </div>
                        </div>
                        <div class="pt-1">
                            <div class="w-full text-xs bg-blue-200 py-1 px-2">
                            <p class="mb-3">If you set a username, you will get a custom URL for your profile.</p>
                            <p class="mb-3">Example: <span class="font-semibold">https://himoot.com/username</span></p>
                            <p><span class="font-semibold">Attention:</span> If you change your username, your previous profile URL will not work anymore and your username will be openly available to other users!
                            </p>
                            </div>
                        </div>
                    </div>
                </div>
                </NonRegularBox>

                <NonRegularBox name="Privacy" pclass="flex items-center justify-between mx-2 text-sm font-semibold text-white mb-0.5 mt-1" backgroundColor="bg-blue-400" borderColor="border-blue-400">
                    <div class="mx-2 mb-2 mt-1.5">
                        <div class="space-y-2">
                            <div>
                                    <div class="text-[12.8px] ml-0.5">Show online status on your profile:</div>
                                    <select class="py-1 px-3 pr-9 block w-full border border-gray-300 text-sm focus:border-gray-300 focus:ring-transparent">
                                        <option>Yes</option> 
                                        <option>No</option>
                                </select>
                            </div>
                            <div>
                                <div class="text-[12.8px] ml-0.5">Who can start an IM conversation with you:</div>
                                <select class="py-1 px-3 pr-9 block w-full border border-gray-300 text-sm focus:border-gray-300 focus:ring-transparent">
                                    <option>Your Friends</option>
                                    <option>Everyone</option>
                                    <option>No One</option>
                                </select>
                            </div>
                            <div>
                                <div class="text-[12.8px]">Who can view your Profile:</div>
                                <select class="py-1 px-3 pr-5 block w-full border border-gray-300 text-sm focus:border-gray-300 focus:ring-transparent">
                                <option>Everyone (Public)</option>
                                <option>Only Friends (Private)</option>
                                </select>
                            </div>
                            <div class="pt-1">
                                <div class="w-full bg-blue-200 px-2 py-1">
                                    <p class="text-xs mb-1">If your profile is set to <span class="font-semibold">private</span>, only friends can view the content of your profile.</p>
                                    <p class="text-xs">Comments, forums, public blog entries, and other content posted by you will stay public.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </NonRegularBox>

                <NonRegularBox name="Security & Account Access" pclass="flex items-center justify-between mx-2 text-sm font-semibold text-white mb-0.5 mt-1" backgroundColor="bg-blue-400" borderColor="border-blue-400">
                    <div class="my-1 ml-2">
                        <div class="flex items-center space-x-1">
                            <p class="text-sm">2-Factor Authentication:</p>
                            <div class="flex items-center space-x-1"> 
                                <Icon class={ twofactor ? "fill-green-600 h-4 w-4" : "fill-red-600 h-4 w-4" } name={ twofactor ? "circle-check" : "circle-xmark" } />
                                <p class="font-semibold text-sm">{ twofactor ? "Enabled" : "Disabled" }</p>
                                <p class="text-xs"><SmallLink href={ twofactor ? "" : "" } link={ twofactor ? "disable" : "enable" } /></p>
                            </div>
                        </div>
                    </div>
                </NonRegularBox>
            </form>

            <div class="mt-2">
                <button class="py-0.5 px-2 bg-gray-100 hover:bg-gray-200 text-xs border border-black" type="submit">
                    <p class="pt-0.5">Save All</p>
                </button>
            </div>

            <div class="mt-2">
            <p class="text-[12.8px] font-semibold">More Options</p>
                <div class="space-y-2 mt-1">
                    <li class="ml-1 list-disc list-[circle] list-outside text-xs">
                        To change your password, please <a class="text-blue-600 hover:text-red-600 hover:underline" href=`/${username}/resetpassword`>click here</a>.
                    </li>
                    <li class="ml-1 list-disc list-[circle] list-outside text-xs">
                    To export your account data, please <a class="text-blue-600 hover:text-red-600 hover:underline" href=`/${username}/exportdata`>click here</a>.
                    </li>
                    <li class="ml-1 list-disc list-[circle] list-outside text-xs">
                    To permanently delete your account and all your data, please <a class="text-blue-600 hover:text-red-600 hover:underline" href=`/${username}/deleteaccount`>click here</a>.
                    </li>
                    <li class="ml-1 list-disc list-[circle] list-outside text-xs">
                    To manage cookies settings, please <a class="text-blue-600 hover:text-red-600 hover:underline cursor-pointer" data-cc="c-settings" href="#">click here</a>.
                    </li>
                </div>
            </div>
</Layout>