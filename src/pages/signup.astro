---
import LoginLayout from '@lay/LoginLayout.astro';
---
<LoginLayout title="Signup" pagetitle="Signup">
    <div class="p-6 px-2 mx-[50px]">
      <form id="signupForm" class="space-y-4">
        <!-- Name -->
        <div>
          <label for="name" class="block text-sm font-medium text-gray-700">Name</label>
          <input
            type="text"
            id="name"
            name="name"
            class="mt-1 block w-full border-gray-300 focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
            placeholder="Full Name"
            required
          />
        </div>

        <!-- Email -->
        <div>
          <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
          <input
            type="email"
            id="email"
            name="email"
            class="mt-1 block w-full border-gray-300 focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
            placeholder="Email Address"
            required
          />
        </div>

        <!-- Password -->
        <div>
          <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
          <input
            type="password"
            id="password"
            name="password"
            class="mt-1 block w-full border-gray-300 focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
            placeholder="Password"
            required
          />
        </div>

        <!-- Submit Button -->
        <div>
          <button
            type="submit"
            class="w-full bg-neutral-950 text-white py-2 px-4 hover:bg-neutral-900 focus:outline-none focus:ring-2 focus:ring-offset-2"
          >
            Sign Up
          </button>
        </div>
      </form>
      <p class="mt-4 text-center text-sm text-gray-600">
        Already have an account? <a href="/login" class="text-blue-500 hover:underline">Log In</a>
      </p>
    </div>

    <!-- Script to Handle Form Submission -->
    <script>
      const signupForm = document.getElementById('signupForm') as HTMLFormElement;

      signupForm.addEventListener('submit', async (event) => {
        event.preventDefault();

        const formData = new FormData(signupForm);
        const name = formData.get('name');
        const email = formData.get('email');
        const password = formData.get('password');

        try {
          const response = await fetch('/api/auth', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              action: 'signup',
              name,
              email,
              password,
            }),
          });

          const result = await response.json();

          if (response.ok) {
            alert('Sign-up successful!');
            window.location.href = '/'; // Redirect to login page after successful sign-up
          } else {
            alert(result.error || 'Sign-up failed');
          }
        } catch (error) {
          console.error('Error during sign-up:', error);
          alert('An error occurred. Please try again.');
        }
      });
    </script>

</LoginLayout>