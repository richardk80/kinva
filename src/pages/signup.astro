---
import LoginLayout from '@lay/LoginLayout.astro';
---
<LoginLayout title="Signup" pagetitle="Signup">
    <div class="py-6 px-2 mx-[50px]">
      <form id="signupForm" class="space-y-4 -mt-3">
        <!-- Name -->
        <div>
          <label for="name" class="block text-sm">Name:</label>
          <input
            type="text"
            id="name"
            name="name"
            class="w-full mt-1 px-3 py-2 border border-neutral-500 text-sm"
            placeholder="Full Name"
            required
          />
        </div>

        <!-- Email -->
        <div>
          <label for="email" class="block text-sm">Email:</label>
          <input
            type="email"
            id="email"
            name="email"
            class="w-full mt-1 px-3 py-2 border border-neutral-500 text-sm"
            placeholder="Email Address"
            required
          />
        </div>

        <!-- Password -->
        <div>
          <label for="password" class="block text-sm">Password:</label>
          <input
            type="password"
            id="password"
            name="password"
            class="w-full mt-1 px-3 py-2 border border-neutral-500 text-sm"
            placeholder="Password"
            required
          />
        </div>

        <!-- Submit Button -->
        <div class="flex items-baseline space-x-3">
          <button
            type="submit"
            class="bg-neutral-950 text-white py-2 px-4 hover:underline"
          >
            Save
          </button>
          <p class="text-sm">
            Already have an account? <a href="/login" class="hover:text-red-600 underline">Log In</a>
          </p>
        </div>
      </form>
    </div>

    <!-- Script to Handle Form Submission -->
    <script>
      const signupForm = document.getElementById('signupForm') as HTMLFormElement;

      signupForm.addEventListener('submit', async (event) => {
        event.preventDefault();

        const formData = new FormData(signupForm);
        const name = formData.get('name');
        const email = formData.get('email');
        const password = formData.get('password');

        try {
          const response = await fetch('/api/auth', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              action: 'signup',
              name,
              email,
              password,
            }),
          });

          const result = await response.json();

          if (response.ok) {
            alert('Sign-up successful!');
            window.location.href = '/'; // Redirect to login page after successful sign-up
          } else {
            alert(result.error || 'Sign-up failed');
          }
        } catch (error) {
          console.error('Error during sign-up:', error);
          alert('An error occurred. Please try again.');
        }
      });
    </script>

</LoginLayout>