---
import RegularBox from '@com/main/RegularBox.astro';
import SmallLink from '@com/main/SmallLink.astro';
import FeedbackProfileImage from '@com/main/FeedbackProfileImage.astro';

const { loggedin, name, username } = Astro.props;

const usercomments = [
  {
    id: 1,
    user: "Aaron",
    loggedin: true,
    livestreaming: false,
    avatar: "https://i.pravatar.cc?img=12",
    timeAgo: "12 hours ago",
    comment: "This website is so good. I love feeling like a teenager from the 2000s",
    replies: []
  },
  {
    id: 2,
    user: "Lindsey",
    loggedin: false,
    livestreaming: false,
    avatar: "https://i.pravatar.cc?img=5",
    timeAgo: "18 hours ago",
    comment: "Not only did you make this awesome website but you also put in a Rick Roll, I can already tell you are a 10/10 person",
    replies: []
  },
  {
    id: 3,
    user: "Lucy",
    loggedin: true,
    livestreaming: true,
    avatar: "https://i.pravatar.cc?img=19",
    timeAgo: "22 hours ago",
    comment: "I like this site",
    replies: []
  },
  {
    id: 4,
    user: "Rachel",
    loggedin: true,
    livestreaming: false,
    avatar: "https://i.pravatar.cc?img=24",
    timeAgo: "2 days ago",
    comment: "This is an awesome site",
    replies: []
  },
  {
    id: 5,
    user: "May",
    loggedin: false,
    livestreaming: false,
    avatar: "https://i.pravatar.cc?img=28",
    timeAgo: "5 days ago",
    comment: "Thanks for the add",
    replies: []
  }
];

// Dynamically count the number of comments
const comments = usercomments.length;

// Set a threshold for showing "view all" link
const feedbackThreshold = 5;
const showViewAll = comments >= feedbackThreshold;
---
<RegularBox 
  username2={`${name}'s Friend Feedback`}
  name2={showViewAll ? "[view all]" : ""}
  pclass="flex items-center justify-between mx-2 text-xs font-semibold text-white mt-0.5" 
  backgroundColor="bg-neutral-950" 
  borderColor="border-neutral-950" 
  aclass="text-[10px] -mt-0.5 font-normal hover:underline text-white" 
  aurl={`${username}/friendfeedback`}
>
    <div class="mt-1 -mb-1.5 mx-2">
      <p class="text-xs flex-1 flex items-center space-x-2">
        <span class="font-semibold">{name} has <span class="text-neutral-950">{comments}</span> { comments === 1 ? 'comment' : 'comments' }</span>
        { loggedin ? 
          <span class="text-xs"><SmallLink href={`${username}/friendfeedback`} link="add comment" /></span>
        : '' 
        }
      </p>
      <div class="divide-y divide-neutral-300">
        {usercomments.map((usercomment) => (
          <div class="pt-2.5 pb-2">
            <div class="flex items-start">
              <a href="/dex">
                <FeedbackProfileImage
                  height={56}
                  width={56}
                  srcurl={usercomment.avatar}
                  altText={usercomment.user}
                  loggedin={usercomment.loggedin}
                  livestreaming={usercomment.livestreaming}
                  titleText={`Visit ${usercomment.user}'s profile`}
                />
              </a>
              <div class="ml-3 w-full -mt-0.5">
                <div class="flex items-center justify-between">
                  <a class="hover:underline" href="/dex">
                    <p class="font-semibold text-xs">{usercomment.user}</p>
                  </a>
                  <p class="text-[11px] text-neutral-950">{usercomment.timeAgo}</p>
                </div>
                <p class="mt-1 text-xs text-neutral-950">{usercomment.comment}</p>
              </div>
            </div>
          </div>
        ))}
      </div>    
    </div>
</RegularBox>