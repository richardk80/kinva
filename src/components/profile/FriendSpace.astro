---
import RegularBox from '@com/main/RegularBox.astro';
import OtherProfileImage from "@com/main/OtherProfileImage.astro";

import { Icon } from 'astro-icon/components';

const { loggedin, name, username, profilepic } = Astro.props;

const peoplecount: number = 45;
const friendnum = peoplecount > 8 ? 8 : peoplecount;

// List of unique first names (ensure there are more than friendnum names)
const firstNames = ['Alex', 'Jordan', 'Taylor', 'Morgan', 'Jamie', 'Casey', 'Riley', 'Cameron'];

// Shuffle function to randomize the array
const shuffleArray = (array) => {
  let shuffledArray = array.slice(); // Copy the array
  for (let i = shuffledArray.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffledArray[i], shuffledArray[j]] = [shuffledArray[j], shuffledArray[i]]; // Swap elements
  }
  return shuffledArray;
};

// Shuffle the names and select the first `friendnum` names
const shuffledNames = shuffleArray(firstNames).slice(0, friendnum);

// Create a list of numbers from 1 to 8
const availableNumbers = shuffleArray(Array.from({ length: 70 }, (_, i) => i + 1));

// Get a unique number from the list
const getUniqueImageNumber = () => availableNumbers.pop();
---

<RegularBox
  username2={`${name}'s`} 
  name="Top 8" 
  name2="[view all]" 
  pclass="flex items-center justify-between mx-2 text-xs font-semibold text-[#ED0707] mt-0.5" 
  backgroundColor="bg-[#f9c56c]" 
  borderColor="border-[#f9c56c]" 
  aclass="text-[10px] -mt-0.5 font-normal hover:underline text-zinc-950" 
  aurl={`/${username}/friends`}
>
  <p class={peoplecount === 0 ? "text-xs font-semibold ml-2 pt-1.5" : "text-xs font-semibold ml-2 pt-2"}>
    {name} has <span class="text-[#ED0707]">{peoplecount > 0 ? peoplecount : '0'}</span> 
    {peoplecount === 1 ? 'friend' : 'friends'}
  </p>

  <div class={peoplecount > 0 ? "grid grid-flow-dense grid-cols-4 gap-x-1 gap-y-2 pt-1 pb-0.5" : "grid grid-flow-dense grid-cols-4 pt-1"}>
    {shuffledNames.map((randomName, index) => (
      <div class={peoplecount > 0 ? "pt-0.5 pb-2 px-1" : "py-0 px-1"}>
        {peoplecount > 0 && (
          <a href={`/${username}`} title={`Visit ${randomName}'s profile`}>
            <div class="flex items-center justify-center flex-col hover:underline text-xs font-semibold text-[#1D4ED8] hover:text-[#ED0707]">
              <p class="mb-0.5">{randomName}</p>
              { profilepic ?
                  <OtherProfileImage
                  width={96}
                  height={96}
                  srcurl={`https://i.pravatar.cc/96?img=${getUniqueImageNumber()}`}
                  altText={`${randomName}'s profile picture`}
                  titleText={`Visit ${randomName}'s profile`}
                  loggedin={loggedin}
                />
                :
                <div class="relative">
                  <Icon class="w-[96px] h-[96px]" name="avatar" />
                    { loggedin && <div class="absolute bottom-0 right-0 block w-[20px] h-[20px] rounded-full bg-green-500 border-[2px] border-white -mb-1 -mr-1">
                    </div> 
                  }
                </div>
              }
            </div>
          </a>
        )}
      </div>
    ))}
  </div>
</RegularBox>
