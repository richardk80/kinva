---
import { Icon } from "astro-icon";
---

<form class="flex items-center space-x-1.5 form mt-0.5">
  <input
    class="block h-6 pl-1 border border-stone-300 resize-none text-sm caret-black focus:outline-none placeholder:text-sm placeholder:italic placeholder:text-stone-400 bg-white w-52 -mt-0.5"
    placeholder="Search Users..."
    id="search"
    name="q"
    autocomplete="off"
    title="Search by name or username"
  />
  <button
    class="inline-flex flex-shrink-0 justify-center items-center h-6 px-2 border border-transparent bg-gray-100 hover:bg-gray-200 focus:outline-none focus:ring-0 focus:ring-transparent focus:ring-offset-0 transition-all -mt-0.5"
    type="submit"
    aria-label="search"
  >
    <div class="m-auto">
      <Icon class="h-[14px] w-[14px] fill-black" name="search" />
    </div>
  </button>
</form>

<script>
  import DOMPurify from "dompurify";
  const form = document.querySelector("form");
  form?.addEventListener("submit", (e) => {
    e.preventDefault();
    const formData = new FormData(form);
    const searchTerm = DOMPurify.sanitize(formData.get("q")?.toString());
    if (!searchTerm || searchTerm.length === 0) return;
    const url = new URL("/search", window.location.origin);
    url.searchParams.set("q", searchTerm);
    window.location.assign(url.toString());
  });
</script>
